<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Open+Sans:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>physX AI Lab | ูุฎุชุจุฑ ููุฒูุงุก 1 ุงูุฐูู</title>
    <style>
      :root {
        --bg: #fbf7ef;
        --card: #ffffff;
        --ink: #1f2937;
        --muted: #6b7280;
        --brand: #8b1d2c;
        --brand2: #c23a4a;
        --line: #e5e7eb;
        --soft: #fff7f1;
        --shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
        --radius: 18px;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        body {
          font-family: "Open Sans", sans-serif;
        }
        .card-buttons {
          display: flex;
          gap: 10px; /* ูุณุงูุฉ ุจูู ุงูุฃุฒุฑุงุฑ */
          justify-content: center; /* ูุฎูููู ุจุงูููุชุตู */
          .card-buttons {
            flex-wrap: wrap;
          } /* ููู: ูููุนูู ูุฑูุจูู ููู ุจุนุถ */
        }

        .card-buttons button {
          font-family: "Cairo", sans-serif;
          white-space: nowrap; /* ูููุน ุงููููุฉ ุชููุณุฑ */
        }
        :lang(ar) {
          font-family: "Cairo", sans-serif;
          direction: rtl;
        }
        background:
          radial-gradient(
            1200px 600px at 20% -10%,
            rgba(139, 29, 44, 0.15),
            transparent 60%
          ),
          radial-gradient(
            900px 500px at 110% 10%,
            rgba(194, 58, 74, 0.12),
            transparent 60%
          ),
          var(--bg);
        color: var(--ink);
      }
      header {
        position: sticky;
        top: 0;
        z-index: 5;
        background: linear-gradient(90deg, var(--brand), #6f1320);
        color: #fff;
        padding: 14px 16px;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.12);
      }
      .topbar {
        max-width: 1100px;
        margin: 0 auto;
        display: flex;
        gap: 12px;
        align-items: center;
        justify-content: space-between;
      }
      .brand {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }
      .brand h1 {
        margin: 0;
        font-size: 18px;
        letter-spacing: 0.3px;
      }
      .brand p {
        margin: 0;
        font-size: 12px;
        opacity: 0.9;
      }
      .navbtns {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }
      button,
      .chip {
        border: 0;
        border-radius: 999px;
        padding: 10px 12px;
        background: rgba(255, 255, 255, 0.12);
        color: #fff;
        cursor: pointer;
        font-weight: 600;
        transition: 0.15s;
      }
      button:hover {
        transform: translateY(-1px);
        background: rgba(255, 255, 255, 0.18);
      }
      button:active {
        transform: translateY(0px);
      }
      .container {
        max-width: 1100px;
        margin: 18px auto 60px;
        padding: 0 16px;
      }

      .hero {
        display: grid;
        grid-template-columns: 1fr;
        gap: 14px;
        margin-top: 16px;
      }

      .panel {
        background: var(--card);
        border: 1px solid var(--line);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 16px;
      }
      .panel h2 {
        margin: 0 0 6px;
        font-size: 18px;
      }
      .panel p {
        margin: 0;
        color: var(--muted);
        line-height: 1.6;
      }
      .pillrow {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin-top: 12px;
      }
      .pill {
        background: var(--soft);
        border: 1px dashed rgba(139, 29, 44, 0.35);
        color: var(--brand);
        padding: 8px 10px;
        border-radius: 999px;
        font-weight: 700;
        font-size: 12px;
      }

      .grid {
        margin-top: 14px;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
        justify-items: center;
      }

      .card {
        background: var(--card);
        border: 1px solid var(--line);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 0;
        cursor: pointer;
        transition: 0.15s;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        min-height: auto;
      }
      .card {
        width: 100%;
        max-width: 280px; /* ุญุฌู ูุฑูุญ ููุงุถุญ */
      }
      .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
      }

      .card-image {
        width: 100%;
        height: 240px; /* ููุณ ุงุฑุชูุงุน ุงูุฑุณู */

        background-size: contain; /* ุงูุตูุฑุฉ ูุงููุฉ */
        background-repeat: no-repeat;
        background-position: center;

        background-color: #fff; /* ุฅุทุงุฑ ุฃุจูุถ ูุธูู */
        border-bottom: 1px solid var(--line);
      }

      .card-content {
        padding: 12px 18px 18px 18px;
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        overflow-wrap: break-word;
        word-wrap: break-word;
      }

      .badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-weight: 800;
        color: var(--brand);
        margin-bottom: 10px;
      }
      .badge span {
        background: rgba(139, 29, 44, 0.1);
        border: 1px solid rgba(139, 29, 44, 0.25);
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        color: var(--brand);
      }
      .card h3 {
        margin: 0 0 6px;
        font-size: 14px;
        line-height: 1.4;
      }
      .card p {
        margin: 0 0 8px 0;
        color: var(--muted);
        line-height: 1.5;
        font-size: 11px;
      }
      .card .sub {
        margin-top: 10px;
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .mini {
        font-size: 11px;
        background: #f3f4f6;
        color: #111827;
        padding: 5px 8px;
        border-radius: 999px;
        border: 1px solid #e5e7eb;
        font-weight: 700;
      }

      .hidden {
        display: none !important;
      }
      .toolbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 14px;
      }
      .crumb {
        color: var(--muted);
        font-size: 13px;
      }
      .tabs {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }
      .tab {
        background: var(--card);
        border: 1px solid var(--line);
        color: var(--ink);
        padding: 9px 12px;
        border-radius: 999px;
        cursor: pointer;
        font-weight: 800;
        font-size: 13px;
      }
      .tab.active {
        border-color: rgba(139, 29, 44, 0.4);
        background: rgba(139, 29, 44, 0.08);
        color: var(--brand);
      }

      .section {
        margin-top: 12px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      .section .panel h3 {
        margin: 0 0 10px;
        font-size: 16px;
      }
      label {
        display: block;
        font-weight: 800;
        margin: 10px 0 6px;
      }
      textarea,
      input,
      select {
        width: 100%;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid var(--line);
        font-size: 14px;
        outline: none;
        background: #fff;
      }
      textarea {
        min-height: 120px;
        resize: vertical;
      }
      .row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .row > * {
        flex: 1;
      }
      .cta {
        background: linear-gradient(90deg, var(--brand), var(--brand2));
        color: #fff;
        border: 0;
        padding: 10px 14px;
        border-radius: 12px;
        font-weight: 900;
        cursor: pointer;
        box-shadow: 0 10px 18px rgba(139, 29, 44, 0.18);
        font-size: 13px;
      }
      .cta:hover {
        filter: brightness(1.05);
      }
      .out {
        background: #0b1220;
        color: #dbeafe;
        border-radius: 14px;
        padding: 12px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        font-family:
          ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", monospace;
        white-space: pre-wrap;
        min-height: 140px;
        font-size: 12px;
      }
      .note {
        margin-top: 8px;
        color: var(--muted);
        font-size: 11px;
        line-height: 1.6;
      }

      .labBox {
        background: linear-gradient(180deg, #fff, #fff7f1);
        border: 1px solid rgba(139, 29, 44, 0.15);
        border-radius: var(--radius);
        padding: 14px;
      }
      .sliderWrap {
        display: grid;
        grid-template-columns: 1fr 140px;
        gap: 10px;
        align-items: center;
        margin: 10px 0;
      }
      input[type="range"] {
        width: 100%;
      }
      .kpi {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin-top: 10px;
      }
      .kpi .k {
        background: #fff;
        border: 1px solid var(--line);
        border-radius: 14px;
        padding: 10px;
        font-size: 12px;
      }
      .k strong {
        display: block;
        color: var(--brand);
        font-size: 12px;
      }
      .k span {
        color: var(--muted);
        font-size: 11px;
      }
      canvas {
        width: 100%;
        height: 240px;
        border-radius: 14px;
        border: 1px solid var(--line);
        background: #fff;
        margin-top: 10px;
      }

      @media (max-width: 920px) {
        .hero {
          grid-template-columns: 1fr;
        }
        .grid {
          grid-template-columns: 1fr;
        }
        .section {
          grid-template-columns: 1fr;
        }
        .kpi {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="topbar">
        <div class="brand">
          <h1>physX AI lab | ูุฎุชุจุฑ ููุฒูุงุก 1 ุงูุฐูู</h1>
          <p>ุงุฏุฑุณ โข ุญู โข ุฌุฑูุจ โข ุงูุชุดู โ ููู ูุตูู ูุชุงุจ ููุฒูุงุก 1 (ุฃูู ุซุงููู)</p>
        </div>
        <div class="navbtns">
          <button id="goHomeBtn" title="ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ">ุงูุฑุฆูุณูุฉ</button>
          <button id="aboutBtn" title="ุนู ุงูุชุทุจูู">ุนู ุงูุชุทุจูู</button>
        </div>
      </div>
    </header>

    <div class="container">
      <!-- HOME -->
      <div id="homeView">
        <div class="hero">
          <div class="panel">
            <h2>๐ ูุฑุญุจุงู ุจู ูู ูุฎุชุจุฑ ููุฒูุงุก 1 ุงูุฐูู</h2>
            <p>
              ููุตุฉ ุชุนููููุฉ ุชูุงุนููุฉ ุชุณุงุนุฏู ุนูู ููู ูุญู ูุณุงุฆู ููุฒูุงุก 1 ุจุทุฑููุฉ ุฐููุฉ
              ูููุชุนุฉ. ุงุฎุชุฑ ุฃู ูุตู ูู ุงููุตูู ุฃุฏูุงู ูุงุณุชูุชุน ุจุชุฌุฑุจุฉ ุชุนููููุฉ ุดุงููุฉ
              ุชุฌูุน ุจูู ุงูุดุฑุญ ูุงูุชุทุจูู ุงูุนููู.
            </p>
            <div class="pillrow"></div>
          </div>
        </div>

        <div class="grid" id="chaptersGrid"></div>
      </div>

      <!-- CHAPTER -->
      <div id="chapterView" class="hidden">
        <div class="toolbar">
          <div class="crumb" id="crumb"></div>
          <div class="tabs">
            <div class="tab active" data-tab="problems">โ๏ธ ุญู ุงููุณุงุฆู</div>
            <div class="tab" data-tab="lab">๐งช ุงููุนูู ุงูุงูุชุฑุงุถู</div>
            <div class="tab" data-tab="enrich">๐ ุงูุฅุซุฑุงุกุงุช</div>
          </div>
        </div>

        <div class="section">
          <div class="panel" id="problemsPanel">
            <h3>โ๏ธ ุญู ุงููุณุงุฆู ุจุงูุดุฑุญ ุฎุทูุฉ ุจุฎุทูุฉ</h3>

            <label>ุงุฎุชุงุฑู ุงูุฏุฑุณ ุฏุงุฎู ุงููุตู</label>
            <select id="lessonSelect"></select>

            <label>ุงุฎุชุงุฑู ุณุคุงู ุฌุงูุฒ (ุงุฎุชูุงุฑู)</label>
            <select id="questionSelect">
              <option value="">โ ุงุฎุชุงุฑู ุณุคุงููุง โ</option>
            </select>
            <p class="note" style="margin-top: 8px">
              ๐ก ุงุฎุชุงุฑู ุณุคุงููุง ุฌุงูุฒูุงุ ุซู ุงุณุชุฎุฏูู ุฃุฒุฑุงุฑ <b>ุงูุชูููุญ</b> ุฃู
              <b>ุงูุญู</b> ุฃุณูููุง.
            </p>

            <!-- ุฃุฒุฑุงุฑ ุงูุฃุณุฆูุฉ ุงูุฌุงูุฒุฉ -->
            <div class="row">
              <button class="cta" id="solveBtn">ุญูู ู ุงุดุฑุญ</button>
              <button
                class="cta"
                id="hintBtn"
                style="background: linear-gradient(90deg, #1f2937, #111827)"
              >
                ุฃุนุทูู ุชูููุญ
              </button>

              <p class="note" style="margin-top: 8px">
                โ ูุฐู ุงูุฃุฒุฑุงุฑ ุชุนูู ููุท ูุน <b>ุงูุณุคุงู ุงูุฌุงูุฒ</b> ุงูุฐู ุชุฎุชุงุฑููู ูู
                ุงููุงุฆูุฉ ุฃุนูุงู.
              </p>

              <label>ุงูุชุจู ุงููุณุฃูุฉ ููุง</label>
              <textarea
                id="problemInput"
                placeholder="ูุซุงู: ุฌุณู ูุชูุชู 2 ูุฌู ุชุคุซุฑ ุนููู ููุฉ 10 ูููุชู... ุงุญุณุจู ุงูุชุณุงุฑุน."
              ></textarea>

              <!-- AI PHYSICS SOLVER (for student's own questions) -->
              <div class="labBox" id="physicsAiBox" style="margin-top: 12px">
                <label style="margin-top: 0"
                  >๐ค ูุณุงุนุฏ ุญู ุงูููุฒูุงุก (ููุฃุณุฆูุฉ ุงูููุชูุจุฉ ูุฏูููุง)</label
                >
                <div class="row" style="align-items: center">
                  <label
                    style="
                      margin: 0;
                      font-weight: 900;
                      display: flex;
                      gap: 8px;
                      align-items: center;
                    "
                  >
                    <input type="checkbox" id="enableRealAI" />
                    ุชูุนูู ุญู AI ุงูุญูููู
                  </label>
                  <select id="aiModeSelect" title="ุงุฎุชูุงุฑ ููุน ุงููุณุงุนุฏุฉ">
                    <option value="hint">ุชูููุญ ููุท</option>
                    <option value="solve" selected>ุญู ูุน ุดุฑุญ</option>
                  </select>
                </div>

                <div class="row" style="margin-top: 10px">
                  <button class="cta" id="aiSolveBtn" style="flex: 1">
                    ุญู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู
                  </button>
                  <button
                    class="cta"
                    id="aiHintBtn"
                    style="
                      flex: 1;
                      background: linear-gradient(90deg, #1f2937, #111827);
                    "
                  >
                    ุชูููุญ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู
                  </button>
                </div>

                <p class="note" id="aiNote" style="margin-bottom: 0">
                  ๐ ูุนูู ูุฐุง ุงูุฎูุงุฑ ููุท ุฅุฐุง ูุงู ุนูุฏู API ูู ุงูุฎูููุฉ (Back-end)
                  ุนูู ุงููุณุงุฑ <b>/api/physics-solve</b>. ุฅุฐุง ูู ููู ููุฌูุฏูุงุ
                  ุณูุณุชูุฑ ุงููููุน ุจุงูุนูู Offline.
                </p>
              </div>
            </div>

            <p class="note">
              โ ูุฐุง ุงููุถุน ูุนูู Offline ุจุฑุฏูุฏ ุชุนููููุฉ ุฐููุฉ ูููุงูุจ ุญู. ๐ง ูุชูุนูู
              AI ุงูุญูููู: ุงุฑุจุทู ุฒุฑ ุงูุญู ุจุฎุฏูุฉ API ูุงุญููุง.
            </p>
          </div>

          <div class="panel">
            <h3>๐ ุงููุชูุฌุฉ ูุงูุดุฑุญ</h3>
            <div class="out" id="aiOut">
              ุงูุชุจู ูุณุฃูุฉ ุฃู ุดุบููู ุงููุนููโฆ ูุณูุธูุฑ ุงูุดุฑุญ ููุง.
            </div>
          </div>
        </div>

        <!-- LAB PANEL -->
        <div id="labPanel" class="hidden">
          <div class="section">
            <div class="panel">
              <h3>๐งช ูุนูู ุงูุญุฑูุฉ ุงูุฎุทูุฉ</h3>
              <div class="labBox">
                <label>ุงูุณุฑุนุฉ ุงูุงุจุชุฏุงุฆูุฉ (ู/ุซ)</label>
                <div class="sliderWrap">
                  <input type="range" id="vRange" min="0" max="30" value="5" />
                  <input type="number" id="vVal" value="5" />
                </div>

                <label>ุงูุฒูู (ุซุงููุฉ)</label>
                <div class="sliderWrap">
                  <input type="range" id="tRange" min="0" max="10" value="2" />
                  <input type="number" id="tVal" value="2" />
                </div>

                <label>ุงูุชุณุงุฑุน (ู/ุซยฒ)</label>
                <div class="sliderWrap">
                  <input
                    type="range"
                    id="aRange"
                    min="-5"
                    max="5"
                    value="1"
                    step="0.1"
                  />
                  <input type="number" id="aVal" value="1" step="0.1" />
                </div>

                <button class="cta" id="runLabBtn">ุดุบูู ุงููุนูู</button>
              </div>
            </div>

            <div class="panel">
              <h3>๐ ุงููุชุงุฆุฌ</h3>
              <div class="kpi">
                <div class="k">
                  <strong>ุงูุฅุฒุงุญุฉ (m)</strong>
                  <span id="sOut"> = 0 ูุชุฑ</span>
                </div>
                <div class="k">
                  <strong>ุงูุณุฑุนุฉ ุงูููุงุฆูุฉ (m/s)</strong>
                  <span id="vxOut"> = 0 ู/ุซ</span>
                </div>
                <div class="k">
                  <strong>ุงูุงุณุชูุชุงุฌ</strong>
                  <span id="insightOut">ุงุถุจุทู ุงูููู ูุดุบููู ุงููุนูู</span>
                </div>
              </div>
              <canvas id="plot"></canvas>
            </div>
          </div>

          <div class="panel">
            <h3>๐ ุดุฑุญ ุงููุชุงุฆุฌ</h3>
            <div class="out" id="aiOut"></div>
          </div>
        </div>

        <!-- ENRICH PANEL -->
        <div id="enrichPanel" class="hidden">
          <div class="section">
            <div class="panel">
              <h3>๐ ุงูุฅุซุฑุงุกุงุช</h3>
              <label>ุงุฎุชุงุฑู ููุน ุงูุฅุซุฑุงุก</label>
              <select id="enrichType">
                <option value="concept">ููููู ูุชูุฏู</option>
                <option value="history">ุชุงุฑูุฎ ุงูููุฒูุงุก</option>
                <option value="realworld">ุชุทุจููุงุช ุญููููุฉ</option>
                <option value="challenge">ุชุญุฏู ุฅุถุงูู</option>
              </select>
              <button class="cta" id="genEnrichBtn" style="margin-top: 12px">
                ุชูููุฏ ุฅุซุฑุงุก
              </button>
            </div>

            <div class="panel">
              <h3>๐ ุงููุญุชูู</h3>
              <div class="out" id="enrichOut">
                ุงุฎุชุฑู ููุน ุฅุซุฑุงุก ูุงุถุบุทู ุงูุชูููุฏโฆ
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ABOUT -->
      <div id="aboutView" class="hidden">
        <div class="panel">
          <h2>ุนู ุงูุชุทุจูู</h2>
          <p>ุชุทุจูู ุชุนูููู ุฐูู ูููุฒูุงุก 1 (ุฃูู ุซุงููู) ูููุฑ:</p>
          <ul>
            <li><b>ุญู ูุณุงุฆู:</b> ุงูุชุจู ุงููุณุฃูุฉ ูุงุญุตูู ุนูู ุดุฑุญ ุฎุทูุฉ ุจุฎุทูุฉ.</li>
            <li><b>ูุนูู ุงูุชุฑุงุถู:</b> ุฌุฑุจู ุงููุนุงุฏูุงุช ูุงูููุงููู ุจุดูู ุชูุงุนูู.</li>
            <li><b>ุฅุซุฑุงุกุงุช:</b> ูุญุชูู ุฅุถุงูู ุนู ุงูููุงููู ูุงูุชุทุจููุงุช.</li>
          </ul>
          <button id="backFromAbout" class="cta">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</button>
        </div>
      </div>
    </div>

    <script>
      const chapters = [
        {
          id: "ch1",
          title: "ุงููุตู 1: ูุฏุฎู ุฅูู ุนูู ุงูููุฒูุงุก",
          image: "ch1-intro.jpg",
          lessons: [
            { id: "1-1", name: "ุงูุฏุฑุณ ุงูุฃูู (1-1): ูุง ุงูููุฒูุงุก" },
            { id: "1-2", name: "ุงูุฏุฑุณ ุงูุซุงูู (1-2): ุงูููุงุณ" },
            { id: "ch1_eval", name: "ุชูููู ุงููุตู ุงูุฃูู (ุฃุณุฆูุฉ 20โ44)" },
            { id: "ch1_exam", name: "ุงูุงุฎุชุจุงุฑ ุงููููู ูููุตู ุงูุฃูู (ุฃุณุฆูุฉ 1โ6)" },
          ],
          focus: "ุงูููุงููู ุงูุฃุณุงุณูุฉุ ุงููุญุฏุงุชุ ุงูููุงุณ.",
        },
        {
          id: "ch2",
          title: "ุงููุตู 2: ุชูุซูู ุงูุญุฑูุฉ",
          image: "ch2-motion.jpg",
          lessons: [
            { id: "2-1", name: "2-1 ุงููููุน ูุงูุฅุฒุงุญุฉ" },
            { id: "2-2", name: "2-2 ุงูุณุฑุนุฉ" },
            { id: "2-3", name: "2-3 ุงูุชุณุงุฑุน" },
          ],
          focus: "ุงูุญุฑูุฉ ุงูุฎุทูุฉุ ุงููุชุฌูุงุชุ ุงูุฑุณูู ุงูุจูุงููุฉ.",
        },
        {
          id: "ch3",
          title: "ุงููุตู 3: ุงูุญุฑูุฉ ุงููุชุณุงุฑุนุฉ ุจุงูุชุธุงู",
          image: "ch3-vectors.jpg",
          lessons: [
            { id: "3-1", name: "3-1 ุงูุชุณุงุฑุน ุงูููุชุธู" },
            { id: "3-2", name: "3-2 ูุนุงุฏูุงุช ุงูุญุฑูุฉ" },
            { id: "3-3", name: "3-3 ุงูุณููุท ุงูุญุฑ" },
          ],
          focus: "ูุนุงุฏูุงุช ุงูุญุฑูุฉุ ุงูุชุณุงุฑุน ุงูุซุงุจุชุ ุงูุณููุท ุงูุญุฑ.",
        },
        {
          id: "ch4",
          title: "ุงููุตู 4: ุงูููู ูู ุจุนุฏ ูุงุญุฏ",
          image: "ch4-forces.jpg",
          lessons: [
            { id: "4-1", name: "4-1 ุงูููุฉ ูุงูุญุฑูุฉ" },
            { id: "4-2", name: "4-2 ุงุณุชุฎุฏุงู ููุงููู ูููุชู" },
            { id: "4-3", name: "4-3 ููู ุงูุชุฃุซูุฑ ุงููุชุจุงุฏู" },
          ],
          focus: "ููุงููู ูููุชูุ ูุฎุทุทุงุช ุงูุฌุณู ุงูุญุฑุ ุงูุชูุงุนู.",
        },
        {
          id: "ch5",
          title: "ุงููุตู 5: ุงูููู ูู ุจุนุฏูู",
          image: "ch5-applications.jpg",
          lessons: [
            { id: "5-1", name: "5-1 ุงููุชุฌูุงุช" },
            { id: "5-2", name: "5-2 ุงูุงุญุชูุงู" },
            { id: "5-3", name: "5-3 ุงูููุฉ ูุงูุญุฑูุฉ ูู ุจุนุฏูู" },
          ],
          focus: "ุชุญููู ุงููุชุฌูุงุชุ ุงูุงุญุชูุงูุ ุงูุญุฑูุฉ ุนูู ูุณุชูู ูุงุฆู.",
        },
        {
          id: "ch6",
          title: "ุงููุตู 6: ุงูุญุฑูุฉ ูู ุจุนุฏูู",
          image: "ch6-2d.jpg",
          lessons: [
            { id: "6-1", name: "6-1 ุญุฑูุฉ ุงูููุฐูู" },
            { id: "6-2", name: "6-2 ุงูุญุฑูุฉ ุงูุฏุงุฆุฑูุฉ" },
            { id: "6-3", name: "6-3 ุงูุณุฑุนุฉ ุงููุชุฌูุฉ ุงููุณุจูุฉ" },
          ],
          focus: "ุงูููุฐููุงุชุ ุงูุฏุงุฆุฑูุฉุ ุงูุญุฑูุฉ ุงููุณุจูุฉ.",
        },
      ];

      const homeView = document.getElementById("homeView");
      const chapterView = document.getElementById("chapterView");
      const aboutView = document.getElementById("aboutView");
      const chaptersGrid = document.getElementById("chaptersGrid");
      const crumb = document.getElementById("crumb");
      const lessonSelect = document.getElementById("lessonSelect");
      const questionSelect = document.getElementById("questionSelect");

      // ุชุญุฏูุซ ูุงุฆูุฉ ุงูุฃุณุฆูุฉ ุนูุฏ ุชุบููุฑ ุงุฎุชูุงุฑ ุงูุฏุฑุณ/ุงูุชูููู/ุงูุงุฎุชุจุงุฑ
      lessonSelect.addEventListener("change", () => {
        selectedQuestion = null;
        if (questionSelect) questionSelect.value = "";
        refreshQuestionSelect();
      });

      const problemsPanel = document.getElementById("problemsPanel");
      const labPanel = document.getElementById("labPanel");
      const enrichPanel = document.getElementById("enrichPanel");
      const aiOut = document.getElementById("aiOut");
      const problemInput = document.getElementById("problemInput");
      const solveBtn = document.getElementById("solveBtn");
      const hintBtn = document.getElementById("hintBtn");
      const enableRealAI = document.getElementById("enableRealAI");
      const aiModeSelect = document.getElementById("aiModeSelect");
      const aiSolveBtn = document.getElementById("aiSolveBtn");
      const aiHintBtn = document.getElementById("aiHintBtn");
      const aiNote = document.getElementById("aiNote");

      async function callPhysicsAI(question, mode) {
        // ูุชุทูุจ ูุฌูุฏ Back-end ุนูู /api/physics-solve
        const payload = {
          question: (question || "").trim(),
          mode: mode || "solve",
        };
        if (!payload.question) {
          return "ุงูุชุจู ูุต ุงููุณุฃูุฉ ุฃูููุง โ๏ธ";
        }

        try {
          aiOut.textContent = "โณ ุฌุงุฑู ุงูุญู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู...";
          const r = await fetch("/api/physics-solve", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          if (!r.ok) {
            const t = await r.text().catch(() => "");
            throw new Error(t || "HTTP " + r.status);
          }
          const data = await r.json();
          return data.answer || "ูู ูุชู ุฅุฑุฌุงุน ุฅุฌุงุจุฉ.";
        } catch (e) {
          // fallback offline
          const offline = offlineSolve(
            payload.question,
            mode === "hint" ? "hint" : "solve",
          );
          const msg = `โ๏ธ ูู ูุชู ุงูุงุชุตุงู ุจุฎุฏูุฉ ุงููAI.

ุณุจุจ ูุญุชูู: ูุง ููุฌุฏ API ุนูู /api/physics-solve ุฃู ููุฌุฏ ุฎุทุฃ ุจุงูุดุจูุฉ.

โ ุชู ุนุฑุถ ุญู Offline ุจุฏููุง ูู ุฐูู:

${offline}`;
          return msg;
        }
      }

      function updateAiButtonsState() {
        const hasManualText = (problemInput.value || "").trim().length > 0;

        // ุฃุฒุฑุงุฑ ุงูุณุคุงู ุงูุฌุงูุฒ
        const hasReady = !!selectedQuestion;
        if (solveBtn) solveBtn.disabled = !hasReady;
        if (hintBtn) hintBtn.disabled = !hasReady;
        if (solveBtn) solveBtn.style.opacity = hasReady ? "1" : "0.6";
        if (hintBtn) hintBtn.style.opacity = hasReady ? "1" : "0.6";

        // ุฃุฒุฑุงุฑ ุงูุฐูุงุก ุงูุงุตุทูุงุนู (ููุฃุณุฆูุฉ ุงูููุชูุจุฉ ูุฏูููุง ููุท)
        const isReadyForAI = !selectedQuestion && hasManualText;
        if (aiSolveBtn) aiSolveBtn.disabled = !isReadyForAI;
        if (aiHintBtn) aiHintBtn.disabled = !isReadyForAI;
        if (aiSolveBtn) aiSolveBtn.style.opacity = isReadyForAI ? "1" : "0.6";
        if (aiHintBtn) aiHintBtn.style.opacity = isReadyForAI ? "1" : "0.6";
      }

      const goHomeBtn = document.getElementById("goHomeBtn");
      const aboutBtn = document.getElementById("aboutBtn");
      const backFromAbout = document.getElementById("backFromAbout");
      const vRange = document.getElementById("vRange");
      const tRange = document.getElementById("tRange");
      const aRange = document.getElementById("aRange");
      const vVal = document.getElementById("vVal");
      const tVal = document.getElementById("tVal");
      const aVal = document.getElementById("aVal");
      const runLabBtn = document.getElementById("runLabBtn");
      const sOut = document.getElementById("sOut");
      const vxOut = document.getElementById("vxOut");
      const insightOut = document.getElementById("insightOut");
      const canvas = document.getElementById("plot");
      const ctx = canvas.getContext("2d");
      const enrichType = document.getElementById("enrichType");
      const genEnrichBtn = document.getElementById("genEnrichBtn");
      const enrichOut = document.getElementById("enrichOut");
      const tabs = Array.from(document.querySelectorAll(".tab"));
      let currentChapter = null;

      const questionBank = {
        ch1: [
          {
            id: "1",
            lesson: "1-1",
            group: "chapter",
            text: "ูุตุจุงุญ ููุงููุชู 50.0ฮฉ ููุตูู ุจุจุทุงุฑูุฉ 9.0V. ุงุญุณุจู ุดุฏุฉ ุงูุชูุงุฑ.",
            hint: "ุงุณุชุฎุฏูู ูุงููู ุฃูู: I = V/R.",
            solution: "I = 9.0 / 50.0 = 0.18 A",
          },
          {
            id: "2",
            lesson: "1-1",
            group: "chapter",
            text: "ุฏุฑุงุฌุฉ ุชุจุฏุฃ ูู ุงูุณููู ูุชุชุณุงุฑุน 6 m/sยฒ ููุฏุฉ 4 s. ุงุญุณุจู ุงูุณุฑุนุฉ ุงูููุงุฆูุฉ.",
            hint: "ุฅุฐุง ุงูุจุฏุงูุฉ ูู ุงูุณููู: v = a t.",
            solution: "v = 6ร4 = 24 m/s",
          },
          {
            id: "3",
            lesson: "1-1",
            group: "chapter",
            text: "ุฌุณู ูุจุฏุฃ ูู ุงูุณููู ูุตู ุฅูู 4.0 m/s ุจุนุฏ ูุทุน 0.400 m ุจุชุณุงุฑุน ุซุงุจุช. ุงุญุณุจู ุงูุชุณุงุฑุน.",
            hint: "ุงุณุชุฎุฏูู vยฒ = v0ยฒ + 2 a ฮx ูุน v0=0.",
            solution: "a = vยฒ/(2ฮx) = 16/(0.8)=20 m/sยฒ",
          },
          {
            id: "4",
            lesson: "1-1",
            group: "chapter",
            text: "ููุฉ ุนููุฏูุฉ 520 N ุชุคุซุฑ ุนูู ุณุทุญุ ููุงู ุงูุถุบุท 32500 N/mยฒ. ุงุญุณุจู ุงููุณุงุญุฉ.",
            hint: "P = F/A โ A = F/P.",
            solution: "A = 520 / 32500 = 0.016 mยฒ",
          },
          {
            id: "5",
            lesson: "1-1",
            group: "chapter",
            text: "ููุงุฐุง ูุณุชุฎุฏู ุงููุนุงุฏูุงุช ููุตู ููุงููู ุงูููุฒูุงุกุ",
            hint: "ููุฑู: ุงููุนุงุฏูุฉ ุชุฑุจุท ูุชุบูุฑุงุช ููููู ุงุฎุชุจุงุฑูุง.",
            solution:
              "ูุฃููุง ุชุนุทู ุนูุงูุฉ ูููุฉ ุฏูููุฉ ุจูู ุงููุชุบูุฑุงุช ูุชุณูุญ ุจุงูุชูุจุค ูุงูุชุญูู ุจุงูุชุฌุฑุจุฉ.",
          },
          {
            id: "6",
            lesson: "1-1",
            group: "chapter",
            text: "ุงุณุชูุชุฌู ูุญุฏุฉ ุงูุชุณูุง (T) ูู ุงูุนูุงูุฉ F = B q v.",
            hint: "ุฃุนูุฏู ุชุฑุชูุจูุง: B = F/(qv) ุซู ุจุฏููู ุงููุญุฏุงุช.",
            solution: "ูุญุฏุฉ B = N/(Aยทm) (ูุชูุงูุฆ kg/(Aยทsยฒ)).",
          },
          {
            id: "7",
            lesson: "1-1",
            group: "chapter",
            text: "ุฃุนูุฏู ุชุฑุชูุจ F = B q v ูุฅูุฌุงุฏ ุงูุณุฑุนุฉ v.",
            hint: "ุงูุณูู ุงูุทุฑููู ุนูู Bq.",
            solution: "v = F/(Bq).",
          },
          {
            id: "8",
            lesson: "1-1",
            group: "chapter",
            text: "ููุณ g ููุงูุช 9.4 m/sยฒ. ูู ุงูููุงุณ ููุจูู ููุงุฑูุฉ ุจู 9.80ุ ุนููู.",
            hint: "ุงุญุณุจู ูุณุจุฉ ุงูุฎุทุฃ ุงูุชูุฑูุจูุฉ.",
            solution:
              "ุงููุฑู 0.40 โ 4%ุ ุบุงูุจูุง ุบูุฑ ููุจูู ุฅู ูุงูุช ุฃุฏูุงุชู ุชุณูุญ ุจุฎุทุฃ ุฃูู. ูุฏ ูููู ุจุณุจุจ ุฒูู ุงูุงุณุชุฌุงุจุฉ/ุทูู ุงูุฎูุท/ุฒุงููุฉ ุงูุงูุชุฒุงุฒโฆ",
          },
          {
            id: "9",
            lesson: "1-2",
            group: "chapter",
            text: "ุญูููู 750 MHz ุฅูู kHz.",
            hint: "1 MHz = 1000 kHz.",
            solution: "750 MHz = 750,000 kHz.",
          },
          {
            id: "10",
            lesson: "1-2",
            group: "chapter",
            text: "ุญูููู 5201 cm ุฅูู km.",
            hint: "ุญูููู ุฅูู m ุซู ุฅูู km.",
            solution: "5201 cm = 52.01 m = 0.05201 km.",
          },
          {
            id: "11",
            lesson: "1-2",
            group: "chapter",
            text: "ูู ุซุงููุฉ ูู ุณูุฉ ูุจูุณุฉ (366 ููููุง)ุ",
            hint: "ุงุถุฑุจู 366ร24ร60ร60.",
            solution: "31,622,400 s.",
          },
          {
            id: "12",
            lesson: "1-2",
            group: "chapter",
            text: "ุญูููู 5.30 m/s ุฅูู km/h.",
            hint: "ููุชุญููู ูู m/s ุฅูู km/h ุงุถุฑุจู ูู 3.6.",
            solution: "5.30ร3.6 = 19.08 โ 19.1 km/h.",
          },
          {
            id: "13",
            lesson: "1-2",
            group: "chapter",
            text: "ุงุญุณุจู ููุฉ ูุบูุงุทูุณูุฉ ุนูู ุจุฑูุชูู ูุชุญุฑู ุนููุฏููุง ูู ูุฌุงู: ุงุณุชุฎุฏูู F = B q v.",
            hint: "ุนูุถู B ู q=1.60ร10โปยนโน C ู v ุซู ุงุถุฑุจู.",
            solution: "F = B q v (ูุซุงู: 4.5ร1.6e-19ร2.4e5 โ 1.73ร10โปยนยณ N).",
          },
          {
            id: "14",
            lesson: "1-2",
            group: "chapter",
            text: "ูุณุทุฑุฉ ูุง ูุจุฏุฃ ุตูุฑูุง ูู ุงูุญุงูุฉ. ูุง ุฃุซุฑ ุฐูู ุนูู ุงูููุงุณุ",
            hint: "ูุฐุง ูุณูู ุฎุทุฃ ุตูุฑู.",
            solution:
              "ููุชุฌ ุงูุญุฑุงู ุซุงุจุช ูู ุฌููุน ุงูููุงุณุงุชุ ูุฌุจ ุทุฑุญ/ุฅุถุงูุฉ ุฅุฒุงุญุฉ ุงูุตูุฑ ูุชุตุญูุญ ุงููุฑุงุกุฉ.",
          },
          {
            id: "15",
            lesson: "1-2",
            group: "chapter",
            text: "ูุงุฑูู ูููุฑููุชุฑ ุณูุฆ ุงููุนุงูุฑุฉ ุจูุณุทุฑุฉ ุฌูุฏุฉ ูู ุญูุซ ุงูุฏูุฉ ูุงูุถุจุท.",
            hint: "ุงูุฏูุฉ = ุตุบุฑ ุชุฏุฑูุฌ ุงูุฌูุงุฒุ ุงูุถุจุท = ูุฑุจู ูู ุงููููุฉ ุงูุญููููุฉ.",
            solution:
              "ุงููููุฑููุชุฑ ุฃุฏู (ุชุฏุฑุฌ ุฃุตุบุฑ) ูููู ุฃูู ุถุจุทูุง ุจุณุจุจ ุณูุก ุงููุนุงูุฑุฉุ ุงููุณุทุฑุฉ ุฃูู ุฏูุฉ ููููุง ูุฏ ุชููู ุฃุถุจุท ุฅู ูุงูุช ูุนุงูุฑุฉ.",
          },
          {
            id: "16",
            lesson: "1-2",
            group: "chapter",
            text: "ูู ุงุฎุชูุงู ุฒุงููุฉ ุงููุธุฑ ูุคุซุฑ ุนูู ุงูููุงุณุ ูุถุญู.",
            hint: "ูุฐุง ุฎุทุฃ ุงุฎุชูุงู ุงูููุธุฑ (Parallax).",
            solution:
              "ูุนูุ ุชุบููุฑ ุฒุงููุฉ ุงููุธุฑ ูุบููุฑ ุงููุฑุงุกุฉ ูุชูู ุงูุฏูุฉ/ูุชุฏููุฑ ุงูุถุจุท. ุงูุญู: ุงููุธุฑ ุนููุฏููุง ุนูู ุงูุชุฏุฑูุฌ.",
          },
          {
            id: "17",
            lesson: "1-2",
            group: "chapter",
            text: "ุทูู ุตุฏููู ููุชูุจ 182 cm. ูุง ุฏูุฉ ูุฐุง ุงูููุงุณุ",
            hint: "ููุฑู: ุฃูุฑุจ 1 cm ูุนูู ยฑ ูุตู ุชุฏุฑูุฌ.",
            solution: "ุบุงูุจูุง ููุงุณ ูุฃูุฑุจ 1 cm โ ุนุฏู ูููู โ ยฑ0.5 cm.",
          },
          {
            id: "18",
            lesson: "1-2",
            group: "chapter",
            text: "ุตูุฏูู ุฃุจุนุงุฏู 19.2 cm ู20.3 cm ู18.1 cm: ุงุญุณุจู ุงูุญุฌูุ ุซู ุงุฑุชูุงุน 12 ุตูุฏูููุง ููู ุจุนุถ.",
            hint: "V = LWHุ ูุงุฑุชูุงุน 12 = 12รุงูุงุฑุชูุงุน.",
            solution:
              "V โ 19.2ร20.3ร18.1 = 7.05ร10ยณ cmยณ. ูุงุฑุชูุงุน 12 ุตูุฏูููุง = 217.2 cm.",
          },
          {
            id: "19",
            lesson: "1-2",
            group: "chapter",
            text: "ูููุณ ุฒูู 7 ุฏูุฑุงุช ููุงู ุงููุชูุณุท ูุนุทู T=65.414 s ูุฒูู ุงูููุงุณ ูุฃูุฑุจ 0.1 s. ููู ุชูุชุจูู ุงููุชูุฌุฉ ุจุฏูุฉ ููุงุณุจุฉุ",
            hint: "ูุฒูุนู ุนุฏู ุงููููู: ฮT โ 0.1/7.",
            solution: "ฮT โ 0.014 s โ T โ 65.41 ยฑ 0.01 s (ุชูุฑูุจ ููุงุณุจ).",
          },
          {
            id: "20",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ุฑุชูุจู ุฎุทูุงุช ุงูุทุฑููุฉ ุงูุนูููุฉ.",
            hint: "ุงูุชุจู: ุณุคุงูโูุฑุถูุฉโุชุฌุฑุจุฉโุชุญูููโุงุณุชูุชุงุฌโุชูุฑุงุฑ.",
            solution:
              "ููุงุญุธุฉ/ุณุคุงู โ ูุฑุถูุฉ โ ุชุฌุฑุจุฉ ูุงุฎุชุจุงุฑ โ ุชุญููู ุจูุงูุงุช โ ุงุณุชูุชุงุฌ โ ุชุนุฏูู/ุชูุฑุงุฑ.",
          },
          {
            id: "21",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ุนุฑููู ุงูุทุฑููุฉ ุงูุนูููุฉ ุจุงุฎุชุตุงุฑ.",
            hint: "ูููุงุช ููุชุงุญูุฉ: ููุงุญุธุฉุ ูุฑุถูุฉุ ุงุฎุชุจุงุฑุ ุชุญููู.",
            solution:
              "ูููุฌ ููุธู ูุงูุชุณุงุจ ุงููุนุฑูุฉ ูุนุชูุฏ ุนูู ุงูููุงุญุธุฉ ูุตูุงุบุฉ ูุฑุถูุงุช ูุงุฎุชุจุงุฑูุง ุจุงูุชุฌุฑุจุฉ ูุชุญููู ุงููุชุงุฆุฌ.",
          },
          {
            id: "22",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ููุงุฐุง ุชุนุฏ ุงูุฑูุงุถูุงุช ูููุฉ ูู ุงูููุฒูุงุกุ",
            hint: "ูุฃููุง ูุบุฉ ุงูุนูุงูุงุช ุจูู ุงููููุงุช.",
            solution:
              "ูุฃููุง ุชุตู ุงูุนูุงูุงุช ุจุฏูุฉุ ูุชุญููู ุงูุธูุงูุฑ ุฅูู ููุงุฐุฌ ูููู ุญุณุงุจูุง ูุงูุชูุจุค ุจูุง.",
          },
          {
            id: "23",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ูุง ุงูููุตูุฏ ุจุงููุธุงู ุงูุฏููู ูููุญุฏุงุช SIุ",
            hint: "ูุธุงู ููุญูุฏ ูููุญุฏุงุช.",
            solution:
              "ูุธุงู ุนุงููู ูุชูุญูุฏ ุงูููุงุณุงุช ูุงููุญุฏุงุช ูุชุณููู ุงูุชูุงุตู ูุงูุชุญูููุงุช.",
          },
          {
            id: "24",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ุญูููู/ุณููู: 100 m ู 1000 m ู 1 m ุจูุญุฏุงุช ููุงุณุจุฉ.",
            hint: "ุงุณุชุฎุฏูู ุจุงุฏุฆุงุช: hecto, kilo.",
            solution: "100 m = 1 hm (ุฃู 0.1 km)ุ 1000 m = 1 kmุ 1 m = 1 m.",
          },
          {
            id: "25",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ูู ุชุฌุฑุจุฉ ุชุฑุจุท ุญุฌู ุจุงููู ุจุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ: ุญุฏุฏู ุงููุชุบูุฑ ุงููุณุชูู ูุงูุชุงุจุน.",
            hint: "ุงููุณุชูู ูู ูุง ุชุบููุฑููู ุนูุฏูุง.",
            solution: "ุงููุณุชูู: ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ. ุงูุชุงุจุน: ุญุฌู ุงูุจุงููู.",
          },
          {
            id: "26",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ูู ุฑุณู ุจูุงูู ููุธูุฑ ุฃู ุงููุชุบูุฑ ุงูุชุงุจุน ูุฒูุฏ ูุน ุงููุณุชูู ููู ููุณ ุฎุทููุง: ูุง ููุน ุงูุนูุงูุฉุ",
            hint: "ุงูุธุฑู ูู ูู ุฎุท ูุณุชููู ุฃู ููุญูู.",
            solution: "ุนูุงูุฉ ุทุฑุฏูุฉ ุบูุฑ ุฎุทูุฉ (ูุนุฏู ุงูุฒูุงุฏุฉ ููุณ ุซุงุจุชูุง).",
          },
          {
            id: "27",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ูู F = m vยฒ / r: ุตููู ุงุนุชูุงุฏ F ุนูู r ู m ู v.",
            hint: "ุงุณุชุฎุฏูู ุงูุชูุงุณุจุงุช.",
            solution: "ูุน r: ุนูุณูุฉุ ูุน m: ุทุฑุฏูุฉุ ูุน v: ุทุฑุฏูุฉ ุชุฑุจูุนูุฉ (โ vยฒ).",
          },
          {
            id: "28",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ูููุฒู ุจูู ูุงููู ููุธุฑูุฉุ ูุจูู ูุฑุถูุฉ ููุธุฑูุฉ.",
            hint: "ุงููุงููู ูุตูุ ุงููุธุฑูุฉ ุชูุณูุฑ.",
            solution:
              "ุงููุงููู: ูุตู ุนูุงูุฉ/ููุท. ุงููุธุฑูุฉ: ุชูุณูุฑ ูุงุณุน ูุฏุนูู ุจุฃุฏูุฉ. ุงููุฑุถูุฉ: ุชููุน ูุงุจู ููุงุฎุชุจุงุฑุ ุงููุธุฑูุฉ: ุชูุณูุฑ ุฑุงุณุฎ.",
          },
          {
            id: "29",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ูุง ูุญุฏุฉ ุงููุซุงูุฉ ูู SIุ",
            hint: "ุงููุซุงูุฉ = ูุชูุฉ/ุญุฌู.",
            solution: "kg/mยณ.",
          },
          {
            id: "30",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ุนูุฏ ููุงุณูู ููุณุฑุนุฉ ูุน ุนุฏู ูููู ูุฎุชูู: ุฃูููุง ุฃุฏู (precision) ูุฃูููุง ุฃุถุจุท (accuracy)ุ",
            hint: "ุงูุฃุฏู: ุฃุตุบุฑ ยฑ. ุงูุฃุถุจุท: ุงูุฃูุฑุจ ูููููุฉ ุงูููุจููุฉ.",
            solution:
              "ุงูุฃุฏู: ุงูุฃุตุบุฑ ุนุฏู ูููู. ุงูุฃุถุจุท: ุงูุฃูุฑุจ ูููููุฉ ุงูููุงุณูุฉ (ุญุชู ูู ูุงู ยฑ ุฃูุจุฑ).",
          },
          {
            id: "31",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ููู ุชููุณูู ุทูู ุฌุณู ุฅุฐุง ูู ูุจุฏุฃ ุนูุฏ ุงูุตูุฑ ุนูู ุงููุณุทุฑุฉุ",
            hint: "ุงูุทูู = ูุฑุงุกุฉ ุงูููุงูุฉ โ ูุฑุงุกุฉ ุงูุจุฏุงูุฉ.",
            solution:
              "ุฎุฐู ูุฑุงุกุชูู (ุจุฏุงูุฉ/ููุงูุฉ) ุซู ุงุทุฑุญู: L = xโ โ xโ ูุน ุฐูุฑ ุนุฏู ุงููููู.",
          },
          {
            id: "32",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ุฌุณู ูุชูุชู 41.63 kg: ุงุญุณุจู ูุฒูู. ุซู ุฅุฐุง ูุงู ุงููุฒู 632 N ุงุญุณุจู ุงููุชูุฉ.",
            hint: "W = mg ู m = W/g.",
            solution: "W โ 41.63ร9.80 = 408 N. ู m โ 632/9.80 = 64.5 kg.",
          },
          {
            id: "33",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ุชุญููู ูู ุงููุญุฏุงุช ูู (0.55 kg)(2.1 m/s)/(9.80 m/sยฒ): ูุง ูุญุฏุฉ ุงููุงุชุฌุ ููู ูู ุถุบุทุ",
            hint: "ุจุณูุทู ุงููุญุฏุงุช: (kgยทm/s)/(m/sยฒ)=kgยทs.",
            solution: "ุงููุงุชุฌ ุจูุญุฏุฉ kgยทsุ ููุณุช ูุญุฏุฉ ุถุบุท (Pa = N/mยฒ).",
          },
          {
            id: "34",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ุญูููู ุฅูู ุงููุชุฑ: 42.3 cmุ 6.2 pmุ 21 kmุ 0.023 mmุ 214 ฮผmุ 57 nm.",
            hint: "ุงุณุชุฎุฏูู ุงูุจุงุฏุฆุงุช ู 1 cm=1e-2 mโฆ",
            solution:
              "0.423 mุ 6.2ร10โปยนยฒ mุ 2.10ร10โด mุ 2.3ร10โปโต mุ 2.14ร10โปโด mุ 5.7ร10โปโธ m.",
          },
          {
            id: "35",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ูุชูุฉ ุฅูุงุก ูุน ูุงุก 51.8 kg ููุชูุฉ ุงูุฅูุงุก 3.64 kg: ูุง ูุชูุฉ ุงููุงุกุ",
            hint: "ุงุทุฑุญู ูุชูุฉ ุงูุฅูุงุก ุงููุงุฑุบ.",
            solution: "m ุงููุงุก = 51.8 โ 3.64 = 48.16 kg.",
          },
          {
            id: "36",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ูู ูุฑุงุกุฉ ููุฒุงู ูุธูุฑ ููุฒูุฉ ุนุดุฑูุฉ ูุงุญุฏุฉ ุจุงูุฌุฑุงู: ูุง ุฃุตุบุฑ ุชุฏุฑูุฌุ",
            hint: "ุฅุฐุง ูุนุฑุถ 0.1 g ููุฐู ุงูุฏูุฉ.",
            solution:
              "ุฃุตุบุฑ ุชุฏุฑูุฌ ุชูุฑูุจูุง 0.1 g (ูุนุฏู ูููู ุชูุฑูุจู ยฑ0.05 ุฅูู ยฑ0.1 g).",
          },
          {
            id: "37",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ุงูุฑุฆู ูููุฉ ุชุฏุฑูุฌ ูู ุฌูุงุฒ ููุงุณ (ุญุณุจ ุงูุดูู ูู ูุชุงุจู) ูุน ุชูุฏูุฑ ุนุฏู ุงููููู.",
            hint: "ุงูุฑุฆู ุฃูุฑุจ ุชุฏุฑูุฌ ุซู ยฑ ูุตูู.",
            solution:
              "ุงูุชุจู ุงููุฑุงุกุฉ ูุฃูุฑุจ ุชุฏุฑูุฌ ูุงุฐูุฑู ุนุฏู ูููู โ ูุตู ุฃุตุบุฑ ุชุฏุฑูุฌ.",
          },
          {
            id: "38",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ูู ุฑุณู ูุชูุฉ-ุญุฌู ูุซูุงุซ ููุงุฏ A,B,C: ุงุณุชูุชุฌู ุงููุชูุฉ ุนูุฏ ุญุฌู ูุนููุ ูุงูุญุฌู ุนูุฏ ูุชูุฉ ูุนููุฉุ ููุง ุงูุฐู ููุซูู ููู ุงูุฎุท.",
            hint: "ุงูููู = ฮm/ฮV = ุงููุซุงูุฉ.",
            solution:
              "ุงูุฑุฆู ุงูููู ูู ุงูุฑุณู. ููู ุงูุฎุท ููุซู ุงููุซุงูุฉ (ูููุง ุฒุงุฏ ุงูููู ุฒุงุฏุช ุงููุซุงูุฉ).",
          },
          {
            id: "39",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ุชุฌุฑุจุฉ ุณุญุจ ุฌุณู ููุณุงูุฉ ูุฎุชููุฉ ุฑุบู ููุณ ุงููุชูุฉ: ูุง ุงูุณุจุจ ุงููุญุชููุ ูููู ุชุชุญููููุ",
            hint: "ููุฑู ุจุงูุงุญุชูุงู ูููุน ุงูุณุทุญ.",
            solution:
              "ุงูุณุจุจ ุงุฎุชูุงู ุงูุงุญุชูุงู/ุงูุณุทุญ. ููุชุญูู: ุซุจุชู ุงูููุฉ ูุงููุชูุฉ ูุบููุฑู ุงูุณุทุญ ููุฑุฑู ุงูููุงุณ.",
          },
          {
            id: "40",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ุฅุฐุง ูุงู ุนุฏุฏ ุงููุทุฑุงุช 1.7ร10ยฒยน ููุชุจุฎุฑ 10โถ ูุทุฑุฉ/ุซ: ุงุญุณุจู ุงูุฒูู ุจุงูุณููุงุช.",
            hint: "t = N/ุงููุนุฏู ุซู ุญูููู ููุณููุงุช.",
            solution: "t = 1.7ร10ยนโต s โ 5.4ร10โท ุณูุฉ โ 54 ููููู ุณูุฉ.",
          },
          {
            id: "41",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ุญูุถ ุฃุจุนุงุฏู 1.4 m ร 0.600 m ร 0.340 m. ุงุญุณุจู ูุชูุฉ ุงููุงุก ุนูุฏ ฯ=1000 kg/mยณ.",
            hint: "ุงุญุณุจู ุงูุญุฌู ุซู m=ฯV.",
            solution: "V=0.2856 mยณ โ m=285.6 kg โ 286 kg.",
          },
          {
            id: "42",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ุตููู ุชุฌุฑุจุฉ ูููุงุณ ุงุฑุชูุงุน ุงุฑุชุฏุงุฏ ูุฑุฉ ุจุนุฏ ุฅุณูุงุทูุง.",
            hint: "ุซุจุชู ูู ุดูุก ุฅูุง ูุชุบูุฑ ูุงุญุฏ ููุฑุฑู ุงูููุงุณ.",
            solution:
              "ุญุฏุฏู ุงููุชุบูุฑ (ุงูุณุทุญ/ุงูุงุฑุชูุงุน)ุ ุซุจุชู ุงููุฑุฉ ูุงูุทุฑููุฉุ ูุฑุฑู 5 ูุฑุงุชุ ุงุณุชุฎุฏูู ูุณุทุฑุฉ/ุชุตููุฑ ุจุทูุกุ ุงุญุณุจู ุงููุชูุณุท ูุงูุงูุญุฑุงู.",
          },
          {
            id: "43",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ุงูุชุจู ููุฑุฉ ูุตูุฑุฉ ุนู ุชุทูุฑ ุงูููุฒูุงุก ูุฏูุฑ ุงูุทุฑููุฉ ุงูุนูููุฉ.",
            hint: "ุงุฐูุฑู: ููุงูููโูุธุฑูุงุชโุชุทุจููุงุชโุฃุฏูุงุช ููุงุณ.",
            solution:
              "ููุฑุฉ ุชุฑุจุท ุชุทูุฑ ุงูููุฒูุงุก ุนุจุฑ ุงูุชุงุฑูุฎ ุจุงูุทุฑููุฉ ุงูุนูููุฉ: ููุงุญุธุฉโูุฑุถูุฉโุชุฌุฑุจุฉโูุงููู/ูุธุฑูุฉ ูุชุทุจููุงุช ุชูููุฉ.",
          },
          {
            id: "44",
            lesson: "ch1_eval",
            group: "chapter",
            text: "ููู ุชุญุณูููู ุฏูุฉ ููุงุณ ุฒูู ุณููุท ุฌุณูุ",
            hint: "ููููู ุฎุทุฃ ุฑุฏ ุงููุนู ููุฑุฑู.",
            solution:
              "ุงุณุชุฎุฏูู ุจูุงุจุฉ ุถูุฆูุฉ/ุญุณุงุณ ุฃู ุชุตููุฑ ุจุทูุกุ ูุฑุฑู ูุฎุฐู ูุชูุณุทูุงุ ุฒูุฏู ุงููุณุงูุฉ ููููู ุชุฃุซูุฑ ุงูููุงุก.",
          },
          {
            id: "MC-1",
            lesson: "ch1_exam",
            group: "scaled",
            text: "ุงูุงุฎุชุจุงุฑ ุงููููู (ุณุคุงู 1): ุชุญุฏูุฏ ุฃู ููุงุณ ุฃูุซุฑ ุถุจุทูุง ุนูุฏ ูุฌูุฏ ยฑ (ุนุฏู ูููู) ูุฎุชูู.",
            hint: "ุงูุฃุตุบุฑ ยฑ ูู ุงูุฃูุซุฑ ุถุจุทูุง.",
            solution:
              "ุงูุฃูุซุฑ ุถุจุทูุง ูู ุฐู ยฑ ุงูุฃุตุบุฑ (ูุซู ยฑ40 ุฃุฏู ูู ยฑ50 ูู ูุงุญูุฉ ุงูุถุจุท/precision).",
          },
          {
            id: "MC-2",
            lesson: "ch1_exam",
            group: "scaled",
            text: "ุงูุงุฎุชุจุงุฑ ุงููููู (ุณุคุงู 2): ุฃู ูููุฉ ุชูุงูุฆ 86.2 cm ุจูุญุฏุฉ ุฃุฎุฑูุ",
            hint: "ุญูููู ุฅูู m ุซู ุฅูู km.",
            solution: "86.2 cm = 0.862 m = 8.62ร10โปโด km.",
          },
          {
            id: "MC-3",
            lesson: "ch1_exam",
            group: "scaled",
            text: "ุงูุงุฎุชุจุงุฑ ุงููููู (ุณุคุงู 3): ุฅุฐุง ูุงูุช ุงููุณุงูุฉ ุจุงููููููุชุฑ ูุงูุณุฑุนุฉ ุจุงููุชุฑ/ุซุ ููู ุชุญุณุจ ุงูุฒูู ุจุงูุซูุงููุ",
            hint: "ุญูููู km ุฅูู m ุซู ุงูุณูู ุนูู ุงูุณุฑุนุฉ.",
            solution: "t(s)= (d_kmร1000)/v(m/s).",
          },
          {
            id: "MC-4",
            lesson: "ch1_exam",
            group: "scaled",
            text: "ุงูุงุฎุชุจุงุฑ ุงููููู (ุณุคุงู 4): ุฃุนูุฏู ุชุฑุชูุจ ูุนุงุฏูุฉ ุงููุซุงูุฉ D=m/V ูุฅูุฌุงุฏ V.",
            hint: "ุงูุณูู m ุนูู D.",
            solution: "V = m/D.",
          },
          {
            id: "MC-5",
            lesson: "ch1_exam",
            group: "scaled",
            text: "ุงูุงุฎุชุจุงุฑ ุงููููู (ุณุคุงู 5): ุงุญุณุจู ููู ุฎุท ูุณุชููู ูู ููุทุชูู ูู ุงูุฑุณู.",
            hint: "ุงูููู = ฮy/ฮx.",
            solution: "ูุซุงู: ูู (0,0) ุฅูู (12,3): ุงูููู=3/12=0.25.",
          },
          {
            id: "MC-6",
            lesson: "ch1_exam",
            group: "scaled",
            text: "ุงูุงุฎุชุจุงุฑ ุงููููู (ุณุคุงู 6): ูุณุฃูุฉ ููุฉ ููุชูุฉ: ุงุณุชูุชุฌู a ูู F ู m ูุทุจููู ูุน ุชุญููู g ุฅูู kg.",
            hint: "a = F/mุ ู 1 kg = 1000 g.",
            solution: "ุฅุฐุง F=2.7 N ู m=350 g=0.350 kg โ a=2.7/0.350=7.7 m/sยฒ.",
          },
        ],
      };

      let selectedQuestion = null;

      function getQuestionById(id) {
        if (!id || !currentChapter) return null;
        const bank = questionBank[currentChapter.id] || [];
        return bank.find((x) => x.id === id) || null;
      }

      function shortLabel(s, n = 40) {
        const t = (s || "").trim();
        return t.length <= n ? t : t.slice(0, n - 1) + "โฆ";
      }

      function refreshQuestionSelect() {
        if (!questionSelect) return;

        // ุฅุนุงุฏุฉ ุชููุฆุฉ ุงููุงุฆูุฉ
        questionSelect.innerHTML = "";
        const opt0 = document.createElement("option");
        opt0.value = "";
        opt0.textContent = "โ ุงุฎุชุงุฑู ุณุคุงููุง โ";
        questionSelect.appendChild(opt0);

        const bank = currentChapter
          ? questionBank[currentChapter.id] || []
          : [];
        if (!bank.length) return;

        const sel = lessonSelect ? lessonSelect.value : "";

        // ููุชุฑุฉ ุงูุฃุณุฆูุฉ ุจุญุณุจ ุงุฎุชูุงุฑ ุงูุฏุฑุณ/ุงูุชูููู/ุงูุงุฎุชุจุงุฑ ุงููููู
        let filtered = [];
        let label = "ุงูุฃุณุฆูุฉ";

        if (sel === "ch1_exam") {
          filtered = bank.filter(
            (q) => q.group === "scaled" && q.lesson === "ch1_exam",
          );
          label = "ุงูุงุฎุชุจุงุฑ ุงููููู (1โ6)";
        } else if (sel === "ch1_eval") {
          filtered = bank.filter(
            (q) => q.group === "chapter" && q.lesson === "ch1_eval",
          );
          label = "ุชูููู ุงููุตู (20โ44)";
        } else {
          // ุฏุฑูุณ ุงููุตู
          filtered = bank.filter(
            (q) => q.group === "chapter" && q.lesson === sel,
          );
          label = `ุฃุณุฆูุฉ ${getLessonName()}`;
        }

        if (!filtered.length) return;

        const og = document.createElement("optgroup");
        og.label = label;

        filtered.forEach((q) => {
          const opt = document.createElement("option");
          opt.value = q.id;
          if (q.group === "scaled") {
            const n = q.id.replace("MC-", "");
            opt.textContent = `ุงุฎุชุจุงุฑ ${n} โ ${shortLabel(q.text.replace(/^ุงูุงุฎุชุจุงุฑ ุงููููู \(ุณุคุงู \d+\):\s*/, ""))}`;
          } else {
            opt.textContent = `ุณ${q.id} โ ${shortLabel(q.text)}`;
          }
          og.appendChild(opt);
        });

        questionSelect.appendChild(og);
      }

      function renderChapters() {
        chaptersGrid.innerHTML = "";
        chapters.forEach((ch) => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
        <div class="card-image" style="background-image:url('${ch.image}')"></div>
        <div class="card-content">
          <div>
            <div class="badge">๐ <span>${ch.id.toUpperCase()}</span></div>
            <h3>${ch.title}</h3>
            <p>${ch.focus}</p>
          </div>
          <div>
            <div class="sub">
              <div class="mini">โ๏ธ ูุณุงุฆู</div>
              <div class="mini">๐งช ูุนูู</div>
              <div class="mini">๐ ุฅุซุฑุงุกุงุช</div>
            </div>
            <p class="note">ุงุถุบุทู ููุฏุฎูู โ</p>
          </div>
        </div>
      `;
          card.addEventListener("click", () => openChapter(ch.id));
          chaptersGrid.appendChild(card);
        });
      }

      function show(view) {
        homeView.classList.add("hidden");
        chapterView.classList.add("hidden");
        aboutView.classList.add("hidden");
        view.classList.remove("hidden");
      }

      function openChapter(chId) {
        currentChapter = chapters.find((c) => c.id === chId);
        if (!currentChapter) return;
        crumb.textContent = `ุฃูุชู ุงูุขู ูู: ${currentChapter.title}`;
        lessonSelect.innerHTML = "";
        currentChapter.lessons.forEach((ls) => {
          const opt = document.createElement("option");
          opt.value = ls.id;
          opt.textContent = ls.name;
          lessonSelect.appendChild(opt);
        });
        aiOut.textContent = "ุงูุชุจู ูุณุฃูุฉ ุฃู ุดุบููู ุงููุนููโฆ ูุณูุธูุฑ ุงูุดุฑุญ ููุง.";
        problemInput.value = "";
        selectedQuestion = null;
        if (questionSelect) questionSelect.value = "";
        refreshQuestionSelect();
        setTab("problems");
        show(chapterView);
      }

      function goHome() {
        currentChapter = null;
        show(homeView);
      }

      goHomeBtn.addEventListener("click", goHome);
      aboutBtn.addEventListener("click", () => show(aboutView));
      backFromAbout.addEventListener("click", () => show(homeView));

      function setTab(name) {
        tabs.forEach((t) =>
          t.classList.toggle("active", t.dataset.tab === name),
        );
        problemsPanel.classList.toggle("hidden", name !== "problems");
        labPanel.classList.toggle("hidden", name !== "lab");
        enrichPanel.classList.toggle("hidden", name !== "enrich");
        if (name === "lab") runLab();
        if (name === "enrich") genEnrichment();
      }

      tabs.forEach((t) =>
        t.addEventListener("click", () => setTab(t.dataset.tab)),
      );

      function getLessonName() {
        const v = lessonSelect.value;
        const found = currentChapter?.lessons.find((x) => x.id === v);
        return found ? found.name : "ุงูุฏุฑุณ";
      }

      function offlineSolve(problemText, mode = "solve") {
        const lesson = getLessonName();
        const chTitle = currentChapter?.title ?? "ุงููุตู";
        const cleaned = (problemText || "").trim();
        if (!cleaned)
          return `(${chTitle} โข ${lesson})\n\nุงูุชุจู ูุต ุงููุณุฃูุฉ ุฃูููุง โ๏ธ`;
        const hasForce = /ููุฉ|ูููุชู|F\b/i.test(cleaned);
        const hasMass = /ูุชูุฉ|ูุฌู|kg/i.test(cleaned);
        const hasAcc = /ุชุณุงุฑุน|ุนุฌูุฉ|m\/s\^2|ู\/ุซ\^2|a\b/i.test(cleaned);
        const hasVel = /ุณุฑุนุฉ|m\/s|ู\/ุซ|v\b/i.test(cleaned);
        const hasTime = /ุฒูู|ุซุงููุฉ|s\b|t\b/i.test(cleaned);
        const hasDist = /ูุณุงูุฉ|ุฅุฒุงุญุฉ|ูุชุฑ|m\b|s\b/i.test(cleaned);
        const hasFree = /ุณููุท|g\b|9\.8/i.test(cleaned);
        if (mode === "hint")
          return `(${chTitle} โข ${lesson})\n\nุชูููุญ โ\n- ุงูุชุจู ุงููุนุทูุงุช\n- ุญุฏุฏู ุงููุทููุจ\n- ุงุฎุชุงุฑู ูุงููู ููุงุณุจ`;
        let steps = [];
        steps.push(`(${chTitle} โข ${lesson})`);
        steps.push(`1) ููู ุงููุทููุจ: ุญุฏุฏู ูุง ุงูุฐู ูุจุญุซ ุนูู.`);
        steps.push(`2) ุงุณุชุฎุฑุงุฌ ุงููุนุทูุงุช: ุงูุชุจู ุงูููู ูุน ุงููุญุฏุงุช.`);
        steps.push(`3) ุงุฎุชูุงุฑ ุงููุงููู ุงูููุงุณุจ:`);
        if (hasForce && hasMass) steps.push(`   - ูุงููู ูููุชู ุงูุซุงูู: F = m a`);
        steps.push(`4) ุงูุชุนููุถ ุจุงูุฃุฑูุงู ุซู ุงูุชุฃูุฏ ูู ุงููุญุฏุงุช.`);
        steps.push(`5) ูุชุงุจุฉ ุงููุชูุฌุฉ ุจุดูู ูุงุถุญ.`);
        return steps.join("\n");
      }

      if (questionSelect) {
        questionSelect.addEventListener("change", () => {
          const q = getQuestionById(questionSelect.value);
          selectedQuestion = q;
          if (q) {
            // ูุนุฑุถ ูุต ุงูุณุคุงู ูู ูุฑุจุน ุงูุฅุฏุฎุงู (ูููู ููุทุงูุจุฉ ุชุนุฏููู)
            problemInput.value = q.text;
            aiOut.textContent =
              "โ ุชู ุงุฎุชูุงุฑ ุณุคุงู ุฌุงูุฒ. ุงุถุบุทู ยซุฃุนุทูู ุชูููุญยป ุฃู ยซุญูู ู ุงุดุฑุญยป.";
          } else {
            aiOut.textContent =
              "ุงูุชุจู ูุณุฃูุฉ ุฃู ุดุบููู ุงููุนููโฆ ูุณูุธูุฑ ุงูุดุฑุญ ููุง.";
          }
        });
      }

      // ุฅุฐุง ุนุฏููุชู ุงููุต ูุฏูููุงุ ุงุนุชุจุฑูู ุณุคุงููุง ุญุฑููุง
      problemInput.addEventListener("input", () => {
        if (
          questionSelect &&
          selectedQuestion &&
          problemInput.value.trim() !== selectedQuestion.text.trim()
        ) {
          questionSelect.value = "";
          selectedQuestion = null;
        }

        // ุฃุฒุฑุงุฑ AI ุงููุฎุตุตุฉ (ููุฃุณุฆูุฉ ุงูููุชูุจุฉ ูุฏูููุง ููุท)
        if (aiSolveBtn) {
          aiSolveBtn.addEventListener("click", async () => {
            if (selectedQuestion) {
              aiOut.textContent =
                "ูุฐุง ุงูุณุคุงู ุฌุงูุฒ ุฏุงุฎู ุจูู ุงูุฃุณุฆูุฉ โ ุงุณุชุฎุฏูู ุฒุฑ ยซุญูู ู ุงุดุฑุญยป ูุนุฑุถ ุงูุญู ุงููุฑูู โ";
              return;
            }
            if (enableRealAI && enableRealAI.checked) {
              aiOut.textContent = await callPhysicsAI(
                problemInput.value,
                "solve",
              );
            } else {
              aiOut.textContent = offlineSolve(problemInput.value, "solve");
            }
          });
        }

        if (aiHintBtn) {
          aiHintBtn.addEventListener("click", async () => {
            if (selectedQuestion) {
              aiOut.textContent =
                "ูุฐุง ุงูุณุคุงู ุฌุงูุฒ ุฏุงุฎู ุจูู ุงูุฃุณุฆูุฉ โ ุงุณุชุฎุฏูู ุฒุฑ ยซุฃุนุทูู ุชูููุญยป โ";
              return;
            }
            if (enableRealAI && enableRealAI.checked) {
              aiOut.textContent = await callPhysicsAI(
                problemInput.value,
                "hint",
              );
            } else {
              aiOut.textContent = offlineSolve(problemInput.value, "hint");
            }
          });
        }

        // ุชุญุฏูุซ ุญุงูุฉ ุฃุฒุฑุงุฑ AI ุนูุฏ ุฃู ุชุบููุฑ
        if (enableRealAI) {
          enableRealAI.addEventListener("change", updateAiButtonsState);
        }
        if (problemInput) {
          problemInput.addEventListener("input", updateAiButtonsState);
        }
        if (questionSelect) {
          questionSelect.addEventListener("change", updateAiButtonsState);
        }

        updateAiButtonsState();
      });

      solveBtn.addEventListener("click", async () => {
        if (selectedQuestion) {
          aiOut.textContent = `๐งฉ ${selectedQuestion.text}

๐ก ุชูููุญ:
${selectedQuestion.hint}

โ ุงูุญู ูุน ุงูุดุฑุญ:
${selectedQuestion.solution}`;
        } else {
          aiOut.textContent =
            "ุงุฎุชุงุฑู ุณุคุงููุง ุฌุงูุฒูุง ูู ุงููุงุฆูุฉ ุฃูููุงุ ุซู ุงุถุบุทู (ุญูู ู ุงุดุฑุญ).";
        }
      });

      hintBtn.addEventListener("click", async () => {
        if (selectedQuestion) {
          aiOut.textContent = `๐ก ุชูููุญ ูุณุคุงู ุณ${selectedQuestion.id}:
${selectedQuestion.hint}`;
        } else {
          aiOut.textContent =
            "ุงุฎุชุงุฑู ุณุคุงููุง ุฌุงูุฒูุง ูู ุงููุงุฆูุฉ ุฃูููุงุ ุซู ุงุถุบุทู (ุฃุนุทูู ุชูููุญ).";
        }
      });

      function syncRangeAndNumber(rangeEl, numEl) {
        rangeEl.addEventListener("input", () => (numEl.value = rangeEl.value));
        numEl.addEventListener("input", () => {
          let v = Number(numEl.value);
          if (Number.isNaN(v)) v = Number(rangeEl.min);
          v = Math.max(Number(rangeEl.min), Math.min(Number(rangeEl.max), v));
          numEl.value = v;
          rangeEl.value = v;
        });
      }
      syncRangeAndNumber(vRange, vVal);
      syncRangeAndNumber(tRange, tVal);
      syncRangeAndNumber(aRange, aVal);

      function runLab() {
        const v = Number(vVal.value);
        const t = Number(tVal.value);
        const a = Number(aVal.value);
        const s = v * t + 0.5 * a * t * t;
        const vx = v + a * t;
        sOut.textContent = ` = ${s.toFixed(2)} ูุชุฑ`;
        vxOut.textContent = ` = ${vx.toFixed(2)} ู/ุซ`;
        let insight = "";
        if (a === 0) insight = "ุงูุญุฑูุฉ ููุชุธูุฉ.";
        else if (a > 0) insight = "ุชุณุงุฑุน ููุฌุจ.";
        else insight = "ุชุณุงุฑุน ุณุงูุจ.";
        insightOut.textContent = insight;
        drawPlot(v, a, t);
        aiOut.textContent = `๐งช ูุชูุฌุฉ ุงููุนูู\ns = ${s.toFixed(2)} ู\nvโ = ${vx.toFixed(2)} ู/ุซ`;
      }

      runLabBtn.addEventListener("click", runLab);

      function drawPlot(v, a, tMax) {
        const W = canvas.width,
          H = canvas.height;
        ctx.clearRect(0, 0, W, H);
        const N = 60;
        let xs = [];
        let yMax = 0;
        for (let i = 0; i <= N; i++) {
          const tt = tMax * (i / N);
          const x = v * tt + 0.5 * a * tt * tt;
          xs.push({ tt, x });
          yMax = Math.max(yMax, x);
        }
        yMax = Math.max(1, yMax);
        const padL = 70,
          padR = 20,
          padT = 20,
          padB = 55;
        const plotW = W - padL - padR;
        const plotH = H - padT - padB;
        ctx.strokeStyle = "#ddd";
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(padL, padT);
        ctx.lineTo(padL, H - padB);
        ctx.lineTo(W - padR, H - padB);
        ctx.stroke();
        ctx.strokeStyle = "#8b1d2c";
        ctx.lineWidth = 2;
        ctx.beginPath();
        for (let i = 0; i < xs.length; i++) {
          const px = padL + (xs[i].tt / tMax) * plotW;
          const py = H - padB - (xs[i].x / yMax) * plotH;
          if (i === 0) ctx.moveTo(px, py);
          else ctx.lineTo(px, py);
        }
        ctx.stroke();
      }

      function genEnrichment() {
        const type = enrichType.value;
        const lesson = getLessonName();
        let content = "";
        if (type === "concept") content = `๐ฌ ููููู ูุชูุฏู: ${lesson}`;
        else if (type === "history") content = `๐ ุชุงุฑูุฎ ุงูููุฒูุงุก: ${lesson}`;
        else if (type === "realworld") content = `๐ ุชุทุจููุงุช ุญููููุฉ: ${lesson}`;
        else if (type === "challenge") content = `๐ฏ ุชุญุฏู ุฅุถุงูู: ${lesson}`;
        enrichOut.textContent = content;
      }

      genEnrichBtn.addEventListener("click", genEnrichment);
      renderChapters();
    </script>
  </body>
</html>
